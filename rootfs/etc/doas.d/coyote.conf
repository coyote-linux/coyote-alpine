# Coyote Linux doas configuration
#
# Allow the web server user to perform system configuration tasks

# Allow lighttpd to run the privileged apply helper
# This is the primary mechanism for applying system configuration changes
permit nopass lighttpd cmd /opt/coyote/bin/coyote-apply-helper

# Allow lighttpd to remount the config partition (for saving configuration)
permit nopass lighttpd cmd mount args -o remount,rw /mnt/config
permit nopass lighttpd cmd mount args -o remount,ro /mnt/config

# Allow lighttpd to control services
permit nopass lighttpd cmd rc-service
permit nopass lighttpd cmd rc-update

# Allow lighttpd to reboot/shutdown the system
permit nopass lighttpd cmd reboot
permit nopass lighttpd cmd poweroff

# Allow lighttpd to manage nftables firewall
permit nopass lighttpd cmd /usr/sbin/nft
permit nopass lighttpd cmd /usr/sbin/swanctl
permit nopass lighttpd cmd /usr/bin/wg
permit nopass lighttpd cmd /usr/bin/wg-quick
permit nopass lighttpd cmd /usr/sbin/openvpn
permit nopass lighttpd cmd /usr/share/easy-rsa/easyrsa
permit nopass lighttpd cmd /usr/bin/uacme
